# DL_Indicator
**Универсальная библиотека для вывода данных на различные светодиодные индикаторы через драйвер HT16К33 (Интерфейс I2C) на языке Си с использованием библиотеки HAL**
## Оглавление
1. [Описание](#описание)
2. [Установка](#установка)
3. [Использование](#использование)
4. [Совместимость](#совместимость)
5. [Версии](#версии)
6. [Обратная связь](#обратная-связь)
## Описание  
Библиотека предлагает простой и понятный интерфейс для вывода данных на различные светодиодные индикаторы:
- Используется микросхема HT16K33, подключаемая по интерфейсу I2C
- Количество подключаемых микросхем ограничена адресацией I2C, одна микросхема может иметь 8 адресов в зависимости от состояния перемычек
- Поддерживаемые виды индикаторов:
  * 7 сегментов + точка (до 8 штук на 1 микросхему)
  * 14 сегментов + точка (до 8 штук на 1 микросхему)
  * 16 сегментов без точки (до 8 штук на 1 микросхему)
  * Светодиодная шкала 0 - 16 светодиодов на шкалу (до 8 штук на 1 микросхему)
  * Матрица светодиодов (16х8 максимум)
- Удобные функции для управления аппаратными возможностями микросхемы HT16K33:
  * Включение и выключение тактирования микросхемы
  * Включение и выключение отображения данных на индикаторах
  * Аппаратное мигание с частотой 2Гц, 1Гц, 0.5Гц
  * Задание яркости отображения от 0 до 100% (удобный масштаб, сама микросхема поддерживает 17 ступеней яркости 0 ... 16)
- Удобные функции вывода данных:
  * Прямая запись данных посредством карты битов
  * Прямая очистка памяти
  * Вывод строки, начиная с определенной позиции (универсальна для 7-, 14-, 16- сегментных индикаторов)
  * Вывод целого числа, начиная с определенной позиции (универсальна для 7-, 14-, 16- сегментных индикаторов)
  * Вывод числа с плавающей точкой, начиная с определенной позиции (универсальна для 7-, 14-, 16- сегментных индикаторов)
  * Встроенные функции для создания бегущей строки влево или вправо с заданием скорости (универсальна для 7-, 14-, 16- сегментных индикаторов)
  * Вывод значений на светодиодные шкалы

Заголовочный файл снабжен подробными комментариями.

## Установка
**Установка в директорию с пользовательскими библиотеками (Рекомендуется):**
 1. Скачайте и добавьте директорию **DL_Indicator** в папку с пользовательскими библиотеками вашего проекта (создайте папку, если её нет)
 2. Укажите пути в вашей IDE для директории с заголовочным файлом и файлом реализации
 3. Подключите библиотеку с помощью директивы include:
   ```c
   #include "DL_Indicator"  //Если указаны пути в IDE путь можно не прописывать
   ```
 4. Не забудьте заменить в файле **DL_Indicator** подключаемую HAL библиотеку на вашу версию МК
   ```c
   #include "stm32f1xx_hal.h"  //Замените на свою версию
   ```
**Установка в корень проекта (Проще):**
  1. Добавьте заголовочный файл **DL_Indicator/DL_Indicator.h** в директорию с вашими заголовочными файлами проекта
  2. Добавьте файл реализации **DL_Indicator/DL_Indicator.c** в директорию с вашими заголовочными файлами проекта
  3. Подключите библиотеку с помощью директивы include:
   ```c
   #include "DL_Indicator.h"  //Если библиотека установлена в корень вашего проекта
   ```
  4. Не забудьте заменить в файле **DL_Indicator.h** подключаемую HAL библиотеку на вашу версию МК
   ```c
   #include "stm32f1xx_hal.h"  //Замените на свою версию
   ```
***Важно:***
***Внимательно проверяйте пути к заголовочному файлу и файлу реализации***
## Использование
Проинициализируйте модуль I2C на Вашем МК и подключите микросхему HT16K33 к шине  
### Подключение микросхемы к микроконтроллеру  
![Подключение микросхемы к микроконтроллеру](/images/Connects_MCU_HT16K33.png)  

*Не забудьте подключить питание к микросхеме*  
*Не забудьте поставить подтягивающие резисторы на SDA и SCL, если они не предусмотрены на модуле HT16K33, или вы используете "голую" микросхему*  

Задайте аппаратно адрес микросхемы через пины A0 A1 A2 (см. техническую документацию на HT16K33), если у Вас модуль, то скорее всего достаточно установки перемычек  

*Отсутствие перемычек обычно соответствует адресу 0х70*  

### Правильное подключение индикаторов к микросхеме:

**Наименования сегментов**  

![Наименования сегментов](/images/Segment-Labels.png)  

**Подключение 16-сегментного индикатора**  

![Подключение 16-сегментного индикатора](/images/16_connects.png)  

**Подключение 14-сегментного индикатора**  

![Подключение 14-сегментного индикатора](/images/14_connects.png)  

**Подключение 7-сегментного индикатора**  

![Подключение 7-сегментного индикатора](/images/7_connects.png)  

**Подключение светодиодных шкал**  

![Подключение шкал светодиодов](/images/Bars_connects.png)  


**Подключение матрицы светодиодов**  

![Подключение матрицы светодиодов](/images/Matrix_connects.png)  

*Все индикаторы должны быть с общим катодом (СС1, СС2 ...)*  
*Количество символов может быть меньше по желанию пользователя, соответственно подключать только те катоды, которые нужны*  

### Функции библиотеки с комментариями
```c
void DL_indInit(DL_Indicator* ind, I2C_HandleTypeDef* i2c, DL_IndicatorType type, uint8_t adress);  //Функция инициализации индикатора

void DL_indClkStart(DL_Indicator* ind);  //Запустить тактирование микросхемы HT16K33
void DL_indClkStop(DL_Indicator* ind);  //Остановить тактирование микросхемы HT16K33

void DL_indDisplayON(DL_Indicator* ind);  //Включить отображение на индикаторе
void DL_indDisplayOFF(DL_Indicator* ind);  //Выключить отображение на индикаторе

void DL_indSetBrightness(DL_Indicator* ind, uint8_t duty);  //Установить яркость отображения 0...100%

void DL_indBlinkingStart2Hz(DL_Indicator* ind);  //Запуск аппаратного мигания с частотой 2Гц
void DL_indBlinkingStart1Hz(DL_Indicator* ind);  //Запуск аппаратного мигания с частотой 1Гц
void DL_indBlinkingStart05Hz(DL_Indicator* ind);  //Запуск аппаратного мигания с частотой 0.5Гц
void DL_indBlinkingStop(DL_Indicator* ind);  //Остановка аппаратного мигания

void DL_indPrintBitMap(DL_Indicator* ind, uint16_t* vals, uint8_t size);  //Передать данные на индикатор через карту битов
void DL_indClear(DL_Indicator* ind);  //Очистить дисплей

void DL_indPrintStr(DL_Indicator* ind, const char* str, uint8_t pos);  //Написать строку на 7- 14- или 16-сегментном индикаторе, начиная с позиции pos
void DL_indPrintInt(DL_Indicator* ind, int32_t num, uint8_t pos);  //Написать целое число на 7- 14- или 16-сегментном индикаторе, начиная с позиции pos
void DL_indPrintFloat(DL_Indicator* ind, float num, uint8_t precision, uint8_t pos);  //Написать число с плавающей точкой на 7- 14- или 16-сегментном индикаторе, начиная с позиции pos
void DL_indPrintLeftRunningStr(DL_Indicator* ind, const char* str, uint8_t seg_amount, uint32_t step_time);  //Запуск бегущей строки влево
void DL_indPrintRightRunningStr(DL_Indicator* ind, const char* str, uint8_t seg_amount, uint32_t step_time);  //Запуск бегущей строки вправо

void DL_indPrintBars(DL_Indicator* ind, uint8_t* vals, uint8_t size);  //Записать данные для шкальных индикаторов
```
### Примеры
**Создание структуры 7-сегментного индикатора и инициализация**  
```c
  DL_Indicator my_ind;
  DL_indInit(&my_ind, &hi2c1, DL_7SEGMENT, 0x70);  //Параметры: адрес структуры индикатора, адрес модуля I2C, тип индикатора, адрес индикатора на шине
```
*Поддерживаемые типы индикаторов задаются одним из следующих значений перечисления:*  
- *DL_7SEGMENT*
-	*DL_14SEGMENT*
-	*DL_16SEGMENT*
-	*DL_BAR*
-	*DL_MATRIX*

*По умолчанию функция-инициализатор:*
- *Инициализирует поля структуры индикатора*
- *Включает тактирование микросхемы HT16K33*
-	*Устанавливает яркость на 20%*
-	*Очищает память микросхемы HT16K33*
-	*Включает вывод на индикаторы*

## Совместимость
Библиотека написана, протестирована и гарантированно работает на отладочной плате "Blue Pill Plus" на базе МК STM32F103C8T6.
Благодаря использованию HAL, библиотека должна работать на подавляющем большинстве МК STM32.
## Версии
- v1.0

## Обратная связь
Если вы нашли баг, или есть предложения по доработке, пишите мне в [Телеграм - группу](https://t.me/DLeeFB) для обратной связи =)
